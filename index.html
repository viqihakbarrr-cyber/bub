<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Samurai Predict Multiplayer v2</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Shojumaru&family=Roboto:wght@400;700&display=swap');
        @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css'); /* Untuk Icon */

        :root {
            --bg-color: #1a1a1a;
            --text-color: #fff;
            --my-glow: 0 0 15px #00eaff;    /* Biru untuk diri sendiri */
            --enemy-glow: 0 0 15px #ff0055; /* Merah untuk musuh */
            --selection-color: #00eaff;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Roboto', sans-serif;
            overflow: hidden;
            height: 100vh; width: 100vw;
            user-select: none; -webkit-user-select: none;
        }

        /* SCREEN MANAGERS */
        .screen {
            position: absolute; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 10; transition: opacity 0.5s;
            background: #000;
        }
        .hidden { opacity: 0; pointer-events: none; z-index: -1; }

        /* LOBBY UI */
        #lobby {
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('https://raw.githubusercontent.com/viqihakbarrr-cyber/bub/main/Samu/Sbg.jpg');
            background-size: cover; background-position: center;
        }
        h1 {
            font-family: 'Shojumaru', cursive; color: #ff3333;
            text-shadow: 2px 2px 0 #fff; font-size: 2.5rem; margin-bottom: 30px; text-align: center;
        }
        .btn-main {
            background: #333; border: 2px solid #fff; color: #fff;
            padding: 15px 40px; font-size: 1.2rem; margin: 10px;
            cursor: pointer; border-radius: 8px; font-weight: bold; width: 80%; max-width: 300px;
        }
        .btn-main:active { transform: scale(0.95); background: #555; }
        input[type="number"] {
            padding: 15px; font-size: 1.5rem; text-align: center;
            border-radius: 8px; border: none; margin-bottom: 20px;
            width: 200px; letter-spacing: 5px;
        }
        .status-msg { margin-top: 10px; color: #00eaff; font-size: 0.9rem; text-align: center; padding: 0 20px; }

        /* ARENA UI */
        #arena {
            background-image: url('https://raw.githubusercontent.com/viqihakbarrr-cyber/bub/main/Samu/Sbg.jpg');
            background-size: cover; background-position: center;
            justify-content: space-between; 
        }

        /* HUD */
        .hud-top {
            width: 100%; padding: 10px; display: flex; justify-content: space-between;
            box-sizing: border-box; background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
            position: absolute; top: 0; z-index: 20;
        }
        .player-stats { width: 45%; display: flex; flex-direction: column; gap: 5px; }
        .bar-container { width: 100%; height: 15px; background: #333; border: 1px solid #fff; position: relative; }
        .hp-bar { height: 100%; transition: width 0.3s; }
        .my-hp { background: #00ff00; }
        .enemy-hp { background: #ff0000; }
        .kat-bar { height: 5px; width: 100%; background: #00aaff; transition: width 0.3s; margin-top: 2px; }
        .label { font-size: 0.7rem; font-weight: bold; text-transform: uppercase; }

        /* BATTLEFIELD & CHARACTER */
        .battlefield {
            width: 100%; height: 60%; /* Diberi ruang lebih */
            position: relative; display: flex; align-items: flex-end; margin-top: 50px;
        }
        .character {
            position: absolute; bottom: 0; width: 20%; height: auto;
            transition: left 0.3s ease-out; display: flex; justify-content: center; align-items: flex-end;
        }
        .char-img {
            width: 250%; /* Karakter diperbesar */
            max-width: 250px;
            image-rendering: pixelated;
        }
        
        #my-char .char-img { filter: drop-shadow(var(--my-glow)); }
        #enemy-char .char-img { filter: drop-shadow(var(--enemy-glow)); transform: scaleX(-1); }

        /* FX */
        #fx-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 50; display: flex; justify-content: center; align-items: center;
        }
        .spark { position: absolute; width: 200px; opacity: 0; transition: opacity 0.1s; mix-blend-mode: overlay; }
        .shake { animation: shake 0.5s; }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        /* CONTROLS AREA */
        .controls-area {
            width: 100%; height: 30%; /* Area control diperkecil */
            background: rgba(0,0,0,0.8);
            border-top: 2px solid #fff; display: flex; flex-direction: column; align-items: center; padding: 10px;
        }

        .queue-display {
            height: 30px; width: 90%; 
            margin-bottom: 10px; display: flex; align-items: center; justify-content: flex-start; 
            gap: 10px; color: #ccc; font-size: 0.8rem;
        }

        .btn-grid { 
            display: grid; grid-template-columns: repeat(5, 1fr); /* 5 kolom: 4 aksi + ready */
            gap: 10px; width: 95%; height: 60px;
        }

        .action-btn {
            background: #222; border: 2px solid #666; color: white; padding: 10px 0;
            border-radius: 5px; font-size: 0.8rem; text-transform: uppercase; box-shadow: 0 4px 0 #000;
            position: relative; /* Untuk penomoran */
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .action-btn:active { transform: translateY(4px); box-shadow: 0 0 0 #000; }
        
        .btn-maju { background: #2e7d32; }
        .btn-mundur { background: #5d4037; }
        .btn-attack { background: #c62828; }
        .btn-tangkis { background: #1565c0; }
        .btn-ready { 
            background: #00eaff; color: #000; font-weight: bold;
            grid-column: span 1;
        }

        .selected-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            border: 4px solid var(--selection-color);
            border-radius: 5px;
            pointer-events: none;
            z-index: 5;
            display: flex; justify-content: center; align-items: center;
        }

        .selection-number {
            position: absolute;
            top: -10px; right: -10px;
            background: var(--selection-color);
            color: #000;
            font-size: 0.7rem;
            width: 20px; height: 20px;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold;
        }

        /* WAITING OVERLAY */
        #waiting-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85);
            z-index: 90; display: flex; align-items: center; justify-content: center; color: white;
            flex-direction: column; text-align: center;
        }

        /* TIMER OVERLAY */
        .timer-overlay {
            position: absolute; font-size: 5rem; font-weight: bold; color: white;
            text-shadow: 0 0 20px black; z-index: 100; pointer-events: none; display: none;
        }

        /* RESULT */
        #result-screen { background: rgba(0,0,0,0.9); z-index: 100; }
        .res-text { font-size: 3rem; font-family: 'Shojumaru'; margin-bottom: 20px;}
        .win { color: #00eaff; }
        .lose { color: #ff0055; }
    </style>
</head>
<body>

    <div style="display:none;">
        <img id="preload-idle" src="https://raw.githubusercontent.com/viqihakbarrr-cyber/bub/main/Samu/Sidle.png">
        <img id="preload-maju" src="https://raw.githubusercontent.com/viqihakbarrr-cyber/bub/main/Samu/Smaju.png">
        <img id="preload-mundur" src="https://raw.githubusercontent.com/viqihakbarrr-cyber/bub/main/Samu/Smundur.png">
        <img id="preload-attack" src="https://raw.githubusercontent.com/viqihakbarrr-cyber/bub/main/Samu/Sattack.png">
        <img id="preload-tangkis" src="https://raw.githubusercontent.com/viqihakbarrr-cyber/bub/main/Samu/Stangkis.png">
        <img id="preload-spark" src="https://raw.githubusercontent.com/viqihakbarrr-cyber/bub/main/Samu/Spark.png">
    </div>

    <div id="lobby" class="screen">
        <h1>SAMURAI PREDICT<br><span style="font-size:1rem; font-family:'Roboto'; color:white;">ONLINE PVP</span></h1>
        
        <div id="lobby-menu">
            <button class="btn-main" onclick="setupHost()">CREATE ROOM</button>
            <button class="btn-main" onclick="showJoin()">JOIN ROOM</button>
        </div>

        <div id="create-view" class="hidden" style="text-align:center;">
            <p>Bagikan Kode ke Lawan:</p>
            <h2 id="room-code-display" style="font-size: 3rem; color: #00eaff;">----</h2>
            <p class="status-msg" id="host-status">Menunggu lawan join...</p>
            <button class="btn-main" onclick="location.reload()">BATAL</button>
        </div>

        <div id="join-view" class="hidden" style="text-align:center;">
            <p>Masukkan Kode Lawan:</p>
            <input type="number" id="join-code" placeholder="0000" oninput="if(this.value.length>4) this.value=this.value.slice(0,4)">
            <br>
            <button class="btn-main" onclick="joinGame()">SAMBUNGKAN</button>
            <br>
            <button class="btn-main" style="background:transparent; border:none; font-size:0.8rem;" onclick="location.reload()">BATAL</button>
            <p class="status-msg" id="join-status"></p>
        </div>
    </div>

    <div id="arena" class="screen hidden">
        <div class="hud-top">
            <div class="player-stats">
                <div class="label">YOU (Owner)</div>
                <div class="bar-container"><div class="hp-bar my-hp" id="my-hp-bar" style="width: 100%;"></div></div>
                <div class="kat-bar" id="my-kat-bar" style="width: 100%;"></div>
            </div>
            <div class="player-stats" style="align-items: flex-end;">
                <div class="label">ENEMY</div>
                <div class="bar-container"><div class="hp-bar enemy-hp" id="enemy-hp-bar" style="width: 100%;"></div></div>
                <div class="kat-bar" id="enemy-kat-bar" style="width: 100%;"></div>
            </div>
        </div>

        <div class="timer-overlay" id="timer-display">3</div>
        
        <div id="waiting-overlay" class="hidden">
            <h2>MENUNGGU LAWAN...</h2>
            <p>Kamu sudah siap. Menunggu musuh memilih gerakan.</p>
        </div>

        <div class="battlefield" id="battlefield">
            <div id="fx-layer">
                <img id="spark-fx" class="spark" src="https://raw.githubusercontent.com/viqihakbarrr-cyber/bub/main/Samu/Spark.png">
            </div>

            <div id="my-char" class="character" style="left: 20%;">
                <img src="https://raw.githubusercontent.com/viqihakbarrr-cyber/bub/main/Samu/Sidle.png" class="char-img" id="my-img">
            </div>
            <div id="enemy-char" class="character" style="left: 60%;">
                <img src="https://raw.githubusercontent.com/viqihakbarrr-cyber/bub/main/Samu/Sidle.png" class="char-img" id="enemy-img">
            </div>
        </div>

        <div class="controls-area" id="controls-area">
            <div style="color:white; margin-bottom:5px;">PILIH HINGGA 4 GERAKAN</div>
            <div class="queue-display" id="move-queue"></div>
            
            <div class="btn-grid">
                <button class="action-btn btn-maju" data-move="maju" onclick="addMove('maju', this)">
                    <i class="fa-solid fa-arrow-right"></i> Maju
                </button>
                <button class="action-btn btn-attack" data-move="attack" onclick="addMove('attack', this)">
                    <i class="fa-solid fa-forward"></i> Attack
                </button>
                <button class="action-btn btn-mundur" data-move="mundur" onclick="addMove('mundur', this)">
                    <i class="fa-solid fa-arrow-left"></i> Mundur
                </button>
                <button class="action-btn btn-tangkis" data-move="tangkis" onclick="addMove('tangkis', this)">
                    <i class="fa-solid fa-shield-halved"></i> Tangkis
                </button>
                <button class="action-btn btn-ready" id="ready-btn" onclick="sendMoves()">READY</button>
            </div>
            <p class="status-msg" id="control-msg">Klik tombol untuk memilih gerakan.</p>
        </div>
    </div>

    <div id="result-screen" class="screen hidden">
        <h1 id="result-title" class="res-text"></h1>
        <button class="btn-main" onclick="location.reload()">MAIN LAGI</button>
    </div>

    <script>
        /* ================= CONFIGURATION & ASSETS ================= */
        const MAX_MOVES = 4; // Batas gerakan
        const ASSETS = {
            idle: 'https://raw.githubusercontent.com/viqihakbarrr-cyber/bub/main/Samu/Sidle.png',
            maju: 'https://raw.githubusercontent.com/viqihakbarrr-cyber/bub/main/Samu/Smaju.png',
            mundur: 'https://raw.githubusercontent.com/viqihakbarrr-cyber/bub/main/Samu/Smundur.png',
            attack: 'https://raw.githubusercontent.com/viqihakbarrr-cyber/bub/main/Samu/Sattack.png',
            tangkis: 'https://raw.githubusercontent.com/viqihakbarrr-cyber/bub/main/Samu/Stangkis.png'
        };

        const APP_ID_PREFIX = "samurai-predict-game-v1-"; 
        
        let peer = null;
        let conn = null;
        let myRole = null; // 'host' or 'joiner'

        let gameState = {
            host: { hp: 100, katana: 100, grid: 1 }, 
            joiner: { hp: 100, katana: 100, grid: 3 },
            myMoves: [],
            enemyMoves: [], 
            roundActive: false
        };

        // DOM Elements for easy access
        const DOMElements = {
            controlsArea: document.getElementById('controls-area'),
            readyBtn: document.getElementById('ready-btn'),
            controlMsg: document.getElementById('control-msg'),
            timerDisplay: document.getElementById('timer-display'),
            waitingOverlay: document.getElementById('waiting-overlay'),
            moveQueue: document.getElementById('move-queue'),
        };

        /* ================= NETWORKING (PEERJS) ================= */
        // (Fungsi setupHost, showJoin, joinGame, setupConnectionHandlers, handleData tetap sama)

        function setupHost() {
            document.getElementById('lobby-menu').classList.add('hidden');
            document.getElementById('create-view').classList.remove('hidden');

            const roomCode = Math.floor(1000 + Math.random() * 9000);
            document.getElementById('room-code-display').innerText = roomCode;

            peer = new Peer(APP_ID_PREFIX + roomCode);

            peer.on('open', (id) => {
                document.getElementById('host-status').innerText = "Room dibuat. Menunggu lawan join...";
                myRole = 'host';
            });

            peer.on('connection', (c) => {
                conn = c;
                setupConnectionHandlers();
                document.getElementById('host-status').innerText = "Lawan terhubung! Memulai game...";
                setTimeout(enterArena, 1500);
            });

            peer.on('error', (err) => {
                alert("Gagal membuat room. ID mungkin terpakai. Coba lagi.");
                location.reload();
            });
        }

        function showJoin() {
            document.getElementById('lobby-menu').classList.add('hidden');
            document.getElementById('join-view').classList.remove('hidden');
        }

        function joinGame() {
            const code = document.getElementById('join-code').value;
            if (code.length !== 4) return alert("Masukkan 4 digit kode");

            document.getElementById('join-status').innerText = "Menghubungkan...";
            
            peer = new Peer(); 

            peer.on('open', (id) => {
                conn = peer.connect(APP_ID_PREFIX + code);
                
                conn.on('open', () => {
                    document.getElementById('join-status').innerText = "Terhubung!";
                    myRole = 'joiner';
                    setupConnectionHandlers();
                    setTimeout(enterArena, 1000);
                });

                conn.on('error', (err) => {
                    alert("Room tidak ditemukan atau penuh.");
                });
            });
        }

        function setupConnectionHandlers() {
            conn.on('data', (data) => {
                handleData(data);
            });
            conn.on('close', () => {
                alert("Lawan terputus!");
                location.reload();
            });
        }

        function handleData(data) {
            if (data.type === 'MOVES') {
                gameState.enemyMoves = data.moves;
                checkRoundStart();
            }
        }

        /* ================= GAMEPLAY LOGIC ================= */

        function enterArena() {
            document.getElementById('lobby').classList.add('hidden');
            document.getElementById('arena').classList.remove('hidden');
            updateUI();
        }

        function clearMoveSelectionUI() {
            const moveButtons = document.querySelectorAll('.action-btn[data-move]');
            moveButtons.forEach(btn => {
                btn.classList.remove('selected');
                btn.innerHTML = btn.innerText; // Hapus overlay/nomor
                btn.style.borderColor = ''; 
            });
            DOMElements.moveQueue.innerHTML = '';
        }

        function addMove(type, button) {
            if (gameState.myMoves.length < MAX_MOVES && !gameState.roundActive) {
                
                // Jika gerakan sudah ada di queue, hapus dari queue dan hapus overlay
                const existingIndex = gameState.myMoves.findIndex(m => m === type);
                
                if (button.classList.contains('selected')) {
                    // Jika sudah dipilih, batalkan pilihan terakhir
                    gameState.myMoves.pop();
                    clearMoveSelectionUI(); // Reset visual
                    renderQueueUI(); // Render ulang
                } else {
                    // Tambahkan gerakan baru
                    gameState.myMoves.push(type);
                    renderQueueUI();
                }

            } else if (gameState.myMoves.length === MAX_MOVES) {
                DOMElements.controlMsg.innerText = `Batas maksimum ${MAX_MOVES} gerakan tercapai. Tekan READY.`;
            }
        }
        
        function renderQueueUI() {
            const moveButtons = document.querySelectorAll('.action-btn[data-move]');
            DOMElements.moveQueue.innerHTML = 'Urutan: ' + gameState.myMoves.map(m => `[${m}]`).join(' ');
            
            // Render visual selection
            clearMoveSelectionUI();
            
            gameState.myMoves.forEach((move, index) => {
                const btn = document.querySelector(`.action-btn[data-move="${move}"]`);
                if (btn) {
                    // Buat overlay dan nomor urut
                    let numberSpan = document.createElement('span');
                    numberSpan.className = 'selection-number';
                    numberSpan.innerText = index + 1;
                    
                    let overlayDiv = document.createElement('div');
                    overlayDiv.className = 'selected-overlay';
                    overlayDiv.appendChild(numberSpan);

                    btn.appendChild(overlayDiv);
                    btn.classList.add('selected');
                }
            });
        }

        function sendMoves() {
            if (gameState.myMoves.length === 0) {
                DOMElements.controlMsg.innerText = "Pilih minimal 1 gerakan!";
                return;
            }

            // Hide controls area
            DOMElements.controlsArea.classList.add('hidden');
            DOMElements.waitingOverlay.classList.remove('hidden');

            if (conn && conn.open) {
                conn.send({ type: 'MOVES', moves: gameState.myMoves });
            }

            checkRoundStart();
        }

        function checkRoundStart() {
            if (gameState.myMoves.length > 0 && gameState.enemyMoves.length > 0) {
                DOMElements.waitingOverlay.classList.add('hidden');
                startCombatSequence();
            }
        }

        function startCombatSequence() {
            gameState.roundActive = true;
            
            let count = 3;
            DOMElements.timerDisplay.style.display = 'block';
            DOMElements.timerDisplay.innerText = count;

            const interval = setInterval(() => {
                count--;
                if (count < 0) {
                    clearInterval(interval);
                    DOMElements.timerDisplay.style.display = 'none';
                    executeMoves();
                } else {
                    DOMElements.timerDisplay.innerText = count === 0 ? "FIGHT!" : count;
                }
            }, 1000);
        }

        async function executeMoves() {
            let hostMoves = myRole === 'host' ? gameState.myMoves : gameState.enemyMoves;
            let joinerMoves = myRole === 'host' ? gameState.enemyMoves : gameState.myMoves;
            
            // Loop sejumlah gerakan terbanyak
            const totalMoves = Math.max(hostMoves.length, joinerMoves.length);

            for (let i = 0; i < totalMoves; i++) {
                if (gameState.host.hp <= 0 || gameState.joiner.hp <= 0) break;
                
                const hostMove = hostMoves[i] || 'idle';
                const joinerMove = joinerMoves[i] || 'idle';
                
                await playRound(hostMove, joinerMove);
            }

            checkGameOver();

            // Reset Round
            if (gameState.host.hp > 0 && gameState.joiner.hp > 0) {
                gameState.myMoves = [];
                gameState.enemyMoves = [];
                gameState.roundActive = false;
                
                DOMElements.controlsArea.classList.remove('hidden');
                clearMoveSelectionUI();
                setAnim('my', 'idle');
                setAnim('enemy', 'idle');
            }
        }

        /* ================= CORE BATTLE CALCULATION ================= */
        
        function playRound(hostMove, joinerMove) {
            return new Promise(resolve => {
                
                // 1. Animation Setting
                if (myRole === 'host') {
                    setAnim('my', hostMove);
                    setAnim('enemy', joinerMove);
                } else {
                    setAnim('my', joinerMove);
                    setAnim('enemy', hostMove);
                }

                // 2. Logic Calculation 
                let spark = false;
                let hitHost = false;
                let hitJoiner = false;

                // MOVEMENT
                if (hostMove === 'maju' && gameState.host.grid < 4) gameState.host.grid++;
                if (hostMove === 'mundur' && gameState.host.grid > 0) gameState.host.grid--;
                
                if (joinerMove === 'maju' && gameState.joiner.grid > 0) gameState.joiner.grid--;
                if (joinerMove === 'mundur' && gameState.joiner.grid < 4) gameState.joiner.grid++;

                updateUI(); // Move characters instantly

                // INTERACTION (hanya jika minimal salah satu Attack)
                if (hostMove === 'attack' || joinerMove === 'attack') {
                     // Attack vs Attack
                    if (hostMove === 'attack' && joinerMove === 'attack') {
                        gameState.host.hp -= 10; gameState.host.katana -= 10;
                        gameState.joiner.hp -= 10; gameState.joiner.katana -= 10;
                        hitHost = true; hitJoiner = true;
                    }
                    // Host Attacking
                    else if (hostMove === 'attack') {
                        if (joinerMove === 'maju' || joinerMove === 'mundur' || joinerMove === 'idle') {
                            gameState.joiner.hp -= 20;
                            hitJoiner = true;
                        } else if (joinerMove === 'tangkis') {
                            gameState.host.katana -= 20;
                            spark = true;
                        }
                    }
                    // Joiner Attacking
                    else if (joinerMove === 'attack') {
                        if (hostMove === 'maju' || hostMove === 'mundur' || hostMove === 'idle') {
                            gameState.host.hp -= 20;
                            hitHost = true;
                        } else if (hostMove === 'tangkis') {
                            gameState.joiner.katana -= 20;
                            spark = true;
                        }
                    }
                }
                
                // 3. FX
                if (spark) showSpark();
                if (hitHost || hitJoiner) shakeScreen();

                updateUI();

                setTimeout(resolve, 1500); // Wait for anim
            });
        }

        /* ================= VISUALS & HELPERS ================= */

        function updateUI() {
            const myData = myRole === 'host' ? gameState.host : gameState.joiner;
            const enemyData = myRole === 'host' ? gameState.joiner : gameState.host;

            document.getElementById('my-hp-bar').style.width = Math.max(0, myData.hp) + '%';
            document.getElementById('my-kat-bar').style.width = Math.max(0, myData.katana) + '%';
            
            document.getElementById('enemy-hp-bar').style.width = Math.max(0, enemyData.hp) + '%';
            document.getElementById('enemy-kat-bar').style.width = Math.max(0, enemyData.katana) + '%';

            // POSITIONING LOGIC (Relative Rendering)
            let myVisualGrid, enemyVisualGrid;

            if (myRole === 'host') {
                myVisualGrid = gameState.host.grid;
                enemyVisualGrid = gameState.joiner.grid;
            } else {
                // Flipped Perspective
                myVisualGrid = 4 - gameState.joiner.grid;
                enemyVisualGrid = 4 - gameState.host.grid;
            }

            document.getElementById('my-char').style.left = (myVisualGrid * 20) + '%';
            document.getElementById('enemy-char').style.left = (enemyVisualGrid * 20) + '%';
        }

        function setAnim(who, type) {
            // who = 'my' or 'enemy'
            document.getElementById(`${who}-img`).src = ASSETS[type] || ASSETS.idle; // Gunakan idle jika move tidak terdefinisi
        }

        function showSpark() {
            const s = document.getElementById('spark-fx');
            s.style.opacity = '0.8';
            setTimeout(() => s.style.opacity = '0', 300);
        }

        function shakeScreen() {
            const bf = document.getElementById('battlefield');
            bf.classList.add('shake');
            setTimeout(() => bf.classList.remove('shake'), 500);
        }

        function checkGameOver() {
            if (gameState.host.hp <= 0 || gameState.joiner.hp <= 0) {
                const resScreen = document.getElementById('result-screen');
                const resTitle = document.getElementById('result-title');
                resScreen.classList.remove('hidden');

                let myHp = myRole === 'host' ? gameState.host.hp : gameState.joiner.hp;
                let enemyHp = myRole === 'host' ? gameState.joiner.hp : gameState.host.hp;

                if (myHp <= 0 && enemyHp <= 0) {
                    resTitle.innerText = "SERI";
                    resTitle.className = "res-text";
                } else if (myHp <= 0) {
                    resTitle.innerText = "KAMU KALAH";
                    resTitle.className = "res-text lose";
                } else {
                    resTitle.innerText = "KAMU MENANG";
                    resTitle.className = "res-text win";
                }
            }
        }
    </script>
</body>
</html>

